# Resolve the location of this file and set PROJECT_ROOT to the root
SOURCE="${BASH_SOURCE[0]}"
while [ -h "$SOURCE" ] ; do SOURCE="$(readlink "$SOURCE")"; done
export PROJECT_ROOT="$(cd -P "$(dirname "$SOURCE")/.." && pwd)"

set -a
SERVICE_NAME='matrix'
DCP_DNS_DOMAIN='data.humancellatlas.org'
DEPLOYMENT_STAGE="${DEPLOYMENT_STAGE:-dev}"
MATRIX_SERVICE_VERSION=`(git describe --tags --always)`

if [[ ${DEPLOYMENT_STAGE} = prod ]] ; then
    API_HOST=${SERVICE_NAME}.${DCP_DNS_DOMAIN}
else
    API_HOST=${SERVICE_NAME}.${DEPLOYMENT_STAGE}.${DCP_DNS_DOMAIN}
fi

AWS_DEFAULT_REGION='us-east-1'
LAMBDA_DRIVER_FUNCTION_NAME="dcp-matrix-service-driver-${DEPLOYMENT_STAGE}"
LAMBDA_MAPPER_FUNCTION_NAME="dcp-matrix-service-mapper-${DEPLOYMENT_STAGE}"
LAMBDA_WORKER_FUNCTION_NAME="dcp-matrix-service-worker-${DEPLOYMENT_STAGE}"
LAMBDA_REDUCER_FUNCTION_NAME="dcp-matrix-service-reducer-${DEPLOYMENT_STAGE}"
DYNAMO_STATE_TABLE_NAME="dcp-matrix-service-state-table-${DEPLOYMENT_STAGE}"
DYNAMO_OUTPUT_TABLE_NAME="dcp-matrix-service-output-table-${DEPLOYMENT_STAGE}"
DYNAMO_CACHE_TABLE_NAME="dcp-matrix-service-cache-table-${DEPLOYMENT_STAGE}"
S3_RESULTS_BUCKET="dcp-matrix-service-results-${DEPLOYMENT_STAGE}"
BATCH_CONVERTER_JOB_QUEUE_ARN="arn:aws:batch:${AWS_DEFAULT_REGION}:${ACCOUNT_ID}:job-queue/dcp-matrix-converter-queue-${DEPLOYMENT_STAGE}"
BATCH_CONVERTER_JOB_DEFINITION_ARN="arn:aws:batch:${AWS_DEFAULT_REGION}:${ACCOUNT_ID}:job-definition/dcp-matrix-converter-job-definition-${DEPLOYMENT_STAGE}"
set +a

echo "DEPLOYMENT STAGE IS \"${DEPLOYMENT_STAGE}\""
